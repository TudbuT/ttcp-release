package de.tudbut.mod.client.ttcp.mods.exploit;

import net.minecraft.entity.Entity;
import net.minecraft.entity.item.EntityItemFrame;
import net.minecraft.network.play.client.CPacketUseEntity;
import net.minecraft.util.EnumHand;
import net.minecraft.init.Items;
import de.tudbut.mod.client.ttcp.TTCp;
import de.tudbut.mod.client.ttcp.utils.InventoryUtils;
import de.tudbut.mod.client.ttcp.utils.Module;
import de.tudbut.mod.client.ttcp.utils.Setting;
import de.tudbut.mod.client.ttcp.utils.category.Exploit;
import de.tudbut.obj.Save;

/**
 * @author TudbuT
 * @since 27 Jun 2022
 */

@Exploit
public class AEFDupe extends Module {
    
    @Save
    int tickDelay = 1;
    int tick = 0;
    boolean b = false;
    
    @Save
    boolean wheel = true;
    
    @Override
    public void updateBinds() {
        subComponents.clear();
        subComponents.add(Setting.createInt(1, 20, "Tick delay", this, "tickDelay"));
        subComponents.add(Setting.createBoolean("MouseWheelMode", this, "wheel"));
    }
    
    @Override
    public void onTick() {
        if(tick++ % tickDelay != 0) {
            return;
        }
        Entity hit = TTCp.mc.objectMouseOver.entityHit;
        if (hit instanceof EntityItemFrame) {
            if (wheel) {
                InventoryUtils.setCurrentSlot((InventoryUtils.getCurrentSlot() + 1) % 9);
                mc.player.connection.sendPacket(new CPacketUseEntity(hit));
                mc.player.swingArm(EnumHand.MAIN_HAND);
            }
            else {
                if (mc.player.getHeldItem(EnumHand.MAIN_HAND).getItem() != Items.AIR) {
                    mc.player.connection.sendPacket(new CPacketUseEntity(hit, EnumHand.MAIN_HAND));
                    mc.player.swingArm(EnumHand.MAIN_HAND);
                    mc.player.connection.sendPacket(new CPacketUseEntity(hit));
                    mc.player.swingArm(EnumHand.MAIN_HAND);
                }
            }
        }
    }
}
