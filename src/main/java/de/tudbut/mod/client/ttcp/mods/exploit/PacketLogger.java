package de.tudbut.mod.client.ttcp.mods.exploit;

import net.minecraft.network.Packet;
import net.minecraft.network.play.server.*;
import de.tudbut.mod.client.ttcp.utils.Module;
import de.tudbut.mod.client.ttcp.utils.category.Exploit;
import de.tudbut.parsing.TCN;
import de.tudbut.tools.ObjectSerializerTCN;

import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;

/**
 * @author TudbuT
 * @since 29 Mar 2022
 */

@Exploit
public class PacketLogger extends Module {
    
    public FileOutputStream packetLog;
    
    {
        try {
            packetLog = new FileOutputStream("packets.log");
        }
        catch (FileNotFoundException e) {
            e.printStackTrace();
        }
    }
    
    @Override
    public boolean onPacket(Packet<?> packet) {
        if(
                packet instanceof SPacketEntity ||
                packet instanceof SPacketEntityVelocity ||
                packet instanceof SPacketPlayerPosLook ||
                packet instanceof SPacketEntityTeleport
        ) {
            ObjectSerializerTCN tcn = new ObjectSerializerTCN(packet);
            TCN done = tcn.convertAll().done();
            try {
                packetLog.write(done.toString().getBytes(StandardCharsets.UTF_8));
                packetLog.write(0x0A);
                packetLog.write(0x0A);
                packetLog.write(0x0A);
                packetLog.write(0x0A);
                packetLog.write(0x0A);
            }
            catch (IOException e) {
                e.printStackTrace();
            }
        }
        return super.onPacket(packet);
    }
}
